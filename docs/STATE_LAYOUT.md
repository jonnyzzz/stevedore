# State Layout

Stevedore keeps its **source of truth** as a directory tree on the host, mounted into the running
Stevedore container.

## Root

- Default: `/opt/stevedore`
- Host override (installer): `STEVEDORE_HOST_ROOT`
- Container override: `STEVEDORE_ROOT`

## Layout

```
/opt/stevedore/
  system/
    db.key                      # SQLCipher key (generated by installer)
    stevedore.db                # SQLCipher-encrypted SQLite DB (deployments, parameters, etc)
    install.json                # (optional) installer metadata
  deployments/
    <deployment>/
      repo/
        url.txt                 # git URL
        branch.txt              # branch name
        git/                    # git checkout / bare repo (implementation detail)
        ssh/
          id_ed25519            # generated deploy key (private)
          id_ed25519.pub        # generated deploy key (public)
      parameters/               # reserved / legacy (secrets are NOT stored as plaintext files)
      runtime/
        ...                     # derived state (last sync, last deploy, etc)
      data/                     # per-deployment persistent volumes (Community)
      logs/                     # per-deployment logs (Community)
  shared/                       # shared volumes (planned)
```

## Notes

- **Do not commit** anything from `/opt/stevedore` into Git.
- Prefer using `stevedore.sh` to modify state instead of editing files directly.
- Most directories are created on-demand (installer creates `system/` and `deployments/`; `repo add` creates the per-deployment subfolders).
- Backups are trivial: stop the container, then archive `/opt/stevedore/`.
